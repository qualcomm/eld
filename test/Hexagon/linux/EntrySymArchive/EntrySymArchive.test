#---EntrySymArchive.test--------------------- Executable --------------------#


# This tests if the entry symbol is correctly pulled from the archive.
# Only foo and bar are defined in 1.c
RUN: %clang %clangopts -c %p/Inputs/1.c -o %t1.o
RUN: %ar cr %aropts %tlib.a %t1.o

RUN: %link %linkopts -e foo %tlib.a -t -o %tfoo.out 2>&1| %filecheck %s
RUN: %nm %tfoo.out | %filecheck --check-prefix=FOO %s

RUN: %link %linkopts -e bar %tlib.a -t -o %tbar.out 2>&1 | %filecheck %s
RUN: %nm %tbar.out | %filecheck --check-prefix=BAR %s

RUN: %link %linkopts -e baz %tlib.a -t -o %tbaz.out 2>&1 | %filecheck --check-prefix=WARN %s
RUN: %nm %tbaz.out | %filecheck --check-prefix=BAZ %s

#CHECK-NOT: cannot find entry symbol
#WARN: Warning: baz Entry symbol not found
#FOO: T foo
#BAR: T bar
#BAZ: U baz
